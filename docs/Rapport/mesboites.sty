\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mesboites}[2024/02/15 Boîtes personnalisées pour définitions, propositions, etc.]

% Dépendances
\RequirePackage[dvipsnames]{xcolor} % Pour la définition des couleurs
\RequirePackage[most]{tcolorbox} % Pour les boîtes

% Compteurs pour les différents types de boîtes
\makeatletter
\@ifundefined{definitioncounter}{\newcounter{definitioncounter}}{}
\@ifundefined{propositioncounter}{\newcounter{propositioncounter}}{}
\@ifundefined{theoremecounter}{\newcounter{theoremecounter}}{}
\@ifundefined{lemmecounter}{\newcounter{lemmecounter}}{}
\@ifundefined{corollairecounter}{\newcounter{corollairecounter}}{}
\@ifundefined{exemplecounter}{\newcounter{exemplecounter}}{}
\@ifundefined{methodecounter}{\newcounter{methodecounter}}{}
\@ifundefined{proprietecounter}{\newcounter{proprietecounter}}{}
\@ifundefined{notationcounter}{\newcounter{notationcounter}}{}
\@ifundefined{remarquecounter}{\newcounter{remarquecounter}}{}
\@ifundefined{conseilcounter}{\newcounter{conseilcounter}}{}
\@ifundefined{codecounter}{\newcounter{codecounter}}{}
\@ifundefined{formulecounter}{\newcounter{formulecounter}}{}
\makeatother

\newcommand{\createtitle}[3]{
  \node[fill=#3!20, rounded corners, draw=#3, text=black, line width=0.5pt, inner sep=4pt, anchor=west, xshift=12pt] 
  at (frame.north west) {\bfseries #1 \refstepcounter{#2}\csname the#2\endcsname};
}

\newtcolorbox{genericbox}[4][]{%
    enhanced,
    breakable,
    overlay unbroken and first={
        \createtitle{#2}{#3}{#4}
    },
    colback=#4!5,
    colframe=#4,
    boxrule=1pt,
    arc=3mm,
    top=15pt,
    before=\vspace{0.5cm}\vskip18pt,
    after=\vskip0.2cm,
    #1
}


\newenvironment{definition}[1][]{%
    \genericbox[#1]{Définition}{definitioncounter}{LimeGreen}%
}{%
    \endgenericbox%
}

\newenvironment{proposition}[1][]{%
    \genericbox[#1]{Proposition}{propositioncounter}{SkyBlue}%
}{%
    \endgenericbox%
}

\newenvironment{theoreme}[1][]{%
    \genericbox[#1]{Théorème}{theoremecounter}{Red}%
}{%
    \endgenericbox%
}

\newenvironment{lemme}[1][]{%
    \genericbox[#1]{Lemme}{lemmecounter}{Peach}%
}{%
    \endgenericbox%
}

\newenvironment{corollaire}[1][]{%
    \genericbox[#1]{Corollaire}{corollairecounter}{teal}%
}{%
    \endgenericbox%
}

\newenvironment{exemple}[1][]{%
    \genericbox[#1]{Exemple}{exemplecounter}{YellowOrange}%
}{%
    \endgenericbox%
}

\newenvironment{methode}[1][]{%
    \genericbox[#1]{Méthode}{methodecounter}{gray}%
}{%
    \endgenericbox%
}

\newenvironment{propriete}[1][]{%
    \genericbox[#1]{Propriété}{proprietecounter}{RoyalBlue}%
}{%
    \endgenericbox%
}


\newenvironment{notation}[1][]{%
    \genericbox[#1]{Notation}{notationcounter}{Lavender}%
}{%
    \endgenericbox%
}

\newenvironment{remarque}[1][]{%
    \genericbox[#1]{Remarque}{remarquecounter}{darkgray}%
}{%
    \endgenericbox%
}

\newenvironment{conseil}[1][]{%
    \genericbox[#1]{Conseil}{conseilcounter}{lightgray}%
}{%
    \endgenericbox%
}

\newenvironment{code}[1][]{%
    \genericbox[#1]{Code}{codecounter}{MidnightBlue}%
}{%
    \endgenericbox%
}

\newenvironment{formule}[1][]{%
    \genericbox[#1]{Formule}{formulecounter}{Plum}%
}{%
    \endgenericbox%
}
